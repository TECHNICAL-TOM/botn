<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MR_404_WORLD Login System</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

<style>  
    body {  
        font-family: 'Poppins', sans-serif;  
        background: linear-gradient(135deg, #0a0a0a, #1a1a1a);  
        color: #fff;  
        text-align: center;  
        padding: 20px;  
        transition: filter 0.8s ease;  
    }  
    .container {  
        max-width: 400px;  
        margin: auto;  
        background: rgba(25, 25, 25, 0.9);  
        padding: 20px;  
        border-radius: 15px;  
        box-shadow: 0 0 15px cyan;  
    }  
    .logo {  
        width: 120px;  
        height: 120px;  
        border-radius: 50%;  
        object-fit: cover;  
        box-shadow: 0 0 15px cyan;  
    }  
    h1 {  
        margin: 10px 0;  
        color: white;  
        text-shadow: 0 0 10px cyan;  
    }  
    .info {  
        margin: 15px 0;  
        font-size: 16px;  
        color: #ccc;  
        text-align: center;  
    }  
    .info-line {  
        margin: 12px 0;  
        display: block;  
    }  
    input {  
        width: 90%;  
        padding: 10px;  
        margin: 10px 0;  
        border-radius: 8px;  
        border: none;  
        font-size: 16px;  
    }
    
    /* Button Styles */
    button.login-btn, button.check-btn, button.copy-btn, #clamsBtn {  
        padding: 12px 25px;  
        border: none;  
        border-radius: 30px;  
        cursor: pointer;  
        font-weight: bold;  
        margin: 8px 5px;  
        font-size: 16px;  
        transition: all 0.3s ease;  
    }  
    button.login-btn { background: cyan; color: #000; }  
    button.check-btn { background: cyan; color: #000; }  
    button.copy-btn { background: lime; color: #000; }  
    #clamsBtn {   
        background: #4caf50;   
        color: #fff;   
        border-radius: 30px;   
        cursor: pointer;   
        font-weight: bold;   
        font-size: 16px;   
        margin: 0;  
        transition: all 0.3s ease;  
    }  
    button:hover {  
        filter: brightness(1.1);  
    }  

    .register-btn, .telegram-btn, .youtube-btn, .health-btn {  
        padding: 12px 25px;  
        border: none;  
        border-radius: 30px;  
        font-weight: bold;  
        font-size: 16px;  
        cursor: pointer;  
    }  
    .register-btn { background: orange; color: #000; margin-bottom: 15px; width: 100%; }  
    .telegram-btn { background: #0088cc; color: #fff; }  
    .youtube-btn { background: red; color: #fff; }  
    .health-btn {   
        background: #4caf50;   
        color: #fff;  
        display: block;  
        margin: 15px auto;  
        width: 90%;  
        text-decoration: none;  
        line-height: 1.5;  
    }  

    .btn-group {  
        display: flex;  
        flex-wrap: nowrap;  
        justify-content: center;  
        gap: 12px;  
        margin-top: 0;  
    }  
    .btn-group button {  
        flex: 1;  
        min-width: 110px;  
        margin: 0;  
    }  

    .code-box {  
        font-size: 18px;  
        margin: 15px 0;  
        padding: 15px;  
        background: rgba(0,0,0,0.3);  
        border-radius: 8px;  
        border: 1px solid #444;  
        color: yellow;  
        text-shadow: 0 0 10px orange;  
    }  
    .date { color: red; font-size: 18px; font-weight: bold; }  
    .time { color: limegreen; font-size: 18px; }  
    .ip-info { color: pink; font-size: 16px; }  
    .device-info { color: #00ffff; font-size: 16px; }  
    #loginMsg { color: red; margin: 10px 0; }  

    /* Modal style for UID list */  
    #uidListModal {  
        display: none;  
        position: fixed;   
        top: 50%;   
        left: 50%;   
        transform: translate(-50%, -50%);  
        background: rgba(0,0,0,0.9);   
        color: #0f0;   
        padding: 20px;   
        border-radius: 10px;  
        max-width: 300px;   
        max-height: 400px;   
        overflow-y: auto;   
        z-index: 9999;  
        text-align: left;  
    }  
    #claimMsg {  
        color: #0f0;   
        font-weight: bold;   
        margin-top: 10px;   
        display: none;  
    }
    
    /* Admin Link */
    .admin-link {
        position: fixed;
        bottom: 10px;
        right: 10px;
        background: rgba(0,0,0,0.7);
        color: cyan;
        padding: 5px 10px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 12px;
    }
</style>  
</head>  
<body>

<!-- Login Box -->
<div class="container" id="loginBox">  
    <img src="logo.png" alt="Logo" class="logo">  
    <h1>MR_404_WORLD</h1>  
    <div class="info">  
        <span class="date info-line">TODAY = <span id="date"></span></span>  
        <span class="time info-line">TIME = <span id="time"></span></span>  
        <span class="ip-info info-line">IP = <span id="ip">Loading...</span></span>  
        <span class="device-info info-line">DEVICE = <span id="device">Loading...</span></span>  
    </div>  

    <input type="text" id="userName" placeholder="Enter Your Name">
    <input type="password" id="password" placeholder="Enter Password">  
    <button class="login-btn" onclick="checkPassword()">Login</button>  
    <p id="loginMsg"></p>
</div>  

<!-- UID Box -->
<div class="container" id="uidBox" style="display:none;">  
    <img src="logo.png" alt="Logo" class="logo">  
    <h1>MR_404_WORLD</h1>  
    <div class="info">  
        <span class="date info-line">TODAY = <span id="date2"></span></span>  
        <span class="time info-line">TIME = <span id="time2"></span></span>  
        <span class="ip-info info-line">IP = <span id="ip2">Loading...</span></span>  
        <span class="device-info info-line">DEVICE = <span id="device2">Loading...</span></span>  
    </div>  

    <input type="text" id="uidInput" placeholder="Enter Your UID">  
    <button class="check-btn" onclick="checkUID()">Check UID</button>  

    <div id="result" class="code-box"></div>  
    <button class="copy-btn" onclick="copyCode()" style="display:none; margin: 0 auto;">Copy Code</button>  

    <button class="register-btn" onclick="window.location.href='register.html'">Register</button>  

    <div class="btn-group">  
        <button class="telegram-btn" onclick="window.open('https://t.me/BDT_404_TEAM')">Telegram</button>  
        <button id="clamsBtn" onclick="showUIDList()">CLAMS</button>  
        <button class="youtube-btn" onclick="window.open('https://youtube.com/@technical-tom')">YouTube</button>  
    </div>  

    <a href="health.html" class="health-btn" target="_blank">Health Center</a>  

    <div id="claimMsg"></div>
</div>  

<!-- UID List Modal -->
<div id="uidListModal">  
    <h3>UID List (<span id="claimCount">0</span>/<span id="dailyLimitDisplay">20</span>)</h3>  
    <ul id="uidListDisplay"></ul>  
    <button onclick="closeUIDList()" style="margin-top:10px; padding:8px 15px;">Close</button>  
</div>

<!-- Admin Panel Link -->
<a href="admin.html" class="admin-link" target="_blank">Admin Panel</a>

<script>  
    // Firebase configuration - REPLACE WITH YOUR CONFIG
    const firebaseConfig = {
  apiKey: "AIzaSyAOuNhKt--y6enJdevW9y2_ysE85UZpQAs",
  authDomain: "mr404world.firebaseapp.com",
  projectId: "mr404world",
  storageBucket: "mr404world.firebasestorage.app",
  messagingSenderId: "870758854797",
  appId: "1:870758854797:web:d15d82c9638b7ad0d4f2c4",
  measurementId: "G-MM021SL5X2"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    // Global variables
    let dailyLimit = 20;
    let giftCode = "929410";
    
    // Load settings from Firebase
    function loadSettings() {
        database.ref('settings/').once('value').then(snapshot => {
            const settings = snapshot.val() || {};
            if (settings.dailyLimit) dailyLimit = settings.dailyLimit;
            if (settings.giftCode) giftCode = settings.giftCode;
            document.getElementById('dailyLimitDisplay').textContent = dailyLimit;
        });
    }
    
    // তারিখ ও সময় আপডেট  
    function updateTime() {  
        const now = new Date();  
        const day = String(now.getDate()).padStart(2, '0');  
        const month = String(now.getMonth() + 1).padStart(2, '0');  
        const year = String(now.getFullYear()).slice(-2);  
        const date = `${day}/${month}/${year}`;  
        const time = now.toLocaleTimeString();  
          
        document.getElementById('date').innerText = date;  
        document.getElementById('time').innerText = time;  
        document.getElementById('date2').innerText = date;  
        document.getElementById('time2').innerText = time;  
    }  
    setInterval(updateTime, 1000);  
    updateTime();  
  
    // ডিভাইস ডিটেকশন  
    function detectDevice() {  
        const ua = navigator.userAgent;  
        let deviceInfo = "";  
          
        if (/Android/i.test(ua)) {  
            const match = ua.match(/Android.*;\s([^;]+)\sBuild/i);  
            deviceInfo = match && match[1] ? match[1].replace(/;/g, '').trim() : "Android Device";  
        }  
        else if (/iPhone|iPad|iPod/i.test(ua)) {  
            deviceInfo = "Apple " + ua.match(/iPhone|iPad|iPod/i)[0];  
        }  
        else if (/Windows NT/i.test(ua)) {  
            deviceInfo = "Windows PC";  
        }  
        else if (/Macintosh/i.test(ua)) {  
            deviceInfo = "Mac Computer";  
        }  
        else if (/Linux/i.test(ua)) {  
            deviceInfo = "Linux Device";  
        }  
        else {  
            deviceInfo = "Unknown Device";  
        }  
          
        return deviceInfo;  
    }  
  
    // তথ্য প্রদর্শন  
    function displayDeviceInfo() {  
        fetch('https://api.ipify.org?format=json')  
            .then(res => res.json())  
            .then(data => {  
                document.getElementById('ip').innerText = data.ip;  
                document.getElementById('ip2').innerText = data.ip;  
            });  
          
        const deviceInfo = detectDevice();  
        document.getElementById('device').innerText = deviceInfo;  
        document.getElementById('device2').innerText = deviceInfo;  
    }  
      
    displayDeviceInfo();
    loadSettings();
  
    // Password Check  
    function checkPassword() {  
        const name = document.getElementById('userName').value.trim();
        const pass = document.getElementById('password').value;  
        
        if (!name) {
            document.getElementById('loginMsg').innerText = "Please enter your name!";
            return;
        }
        
        if (pass === "404TEAM") {  
            // Save login info to Firebase
            const loginData = {
                name: name,
                ip: document.getElementById('ip').innerText,
                device: document.getElementById('device').innerText,
                timestamp: new Date().toISOString()
            };
            
            database.ref('logins/').push(loginData)
                .then(() => {
                    document.getElementById('loginBox').style.display = "none";  
                    document.getElementById('uidBox').style.display = "block";  
                })
                .catch(error => {
                    console.error("Error saving login:", error);
                    document.getElementById('loginMsg').innerText = "Login error!";
                });
        } else {  
            document.getElementById('loginMsg').innerText = "Wrong Password!";  
        }  
    }  
  
    // Check UID
    function checkUID() {  
        const uid = document.getElementById('uidInput').value.trim();  
        const resultDiv = document.getElementById('result');  
        const copyBtn = document.querySelector('.copy-btn');  
        const name = document.getElementById('userName').value.trim();
        const ip = document.getElementById('ip2').innerText;
        const device = document.getElementById('device2').innerText;
  
        if (!uid) {  
            resultDiv.innerHTML = "<p style='color:red'>Please enter UID!</p>";  
            copyBtn.style.display = "none";  
            claimMsg.style.display = "none";  
            return;  
        }  
  
        // Check daily limit
        const today = new Date().toDateString();
        database.ref('claims/').orderByChild('date').equalTo(today).once('value')
            .then(snapshot => {
                const claims = snapshot.val() || {};
                const claimCount = Object.keys(claims).length;
                
                if (claimCount >= dailyLimit) {
                    resultDiv.innerHTML = "<p style='color:orange'>❌ Try Next Day!</p>";  
                    copyBtn.style.display = "none";  
                    claimMsg.style.display = "none";  
                    return;
                }
                
                // Check if UID is valid
                database.ref('validUIDs/').child(uid).once('value')
                    .then(uidSnapshot => {
                        if (uidSnapshot.exists()) {
                            // Check if UID already used today
                            database.ref('claims/').orderByChild('uid').equalTo(uid).once('value')
                                .then(usedSnapshot => {
                                    let alreadyUsed = false;
                                    usedSnapshot.forEach(claim => {
                                        if (claim.val().date === today) {
                                            alreadyUsed = true;
                                        }
                                    });
                                    
                                    if (alreadyUsed) {
                                        resultDiv.innerHTML = `<p style='color:orange'>UID already used today!</p>`;  
                                        copyBtn.style.display = "none";  
                                        claimMsg.style.display = "none";  
                                        return;
                                    }
                                    
                                    // Record the claim
                                    const claimData = {
                                        uid: uid,
                                        name: name,
                                        ip: ip,
                                        device: device,
                                        date: today,
                                        timestamp: new Date().toISOString(),
                                        code: giftCode
                                    };
                                    
                                    database.ref('claims/').push(claimData)
                                        .then(() => {
                                            resultDiv.innerHTML = `✅ Your Code: <span id="code">${giftCode}</span>`;  
                                            copyBtn.style.display = "block";  
                                            
                                            // Send to Telegram
                                            sendUIDToTelegram(uid, name, ip, device);  
                                            
                                            showClaimSuccess(uid);  
                                        });
                                });
                        } else {
                            resultDiv.innerHTML = "<p style='color:red'>অনুগ্রহপূর্বক আপনি আপনার UPLINE / টিম লিডারের সাথে যোগাযোগ করুন</p>";  
                            copyBtn.style.display = "none";  
                            claimMsg.style.display = "none";  
                        }
                    });
            });
    }  
  
    function showUIDList() {  
        const today = new Date().toDateString();
        database.ref('claims/').orderByChild('date').equalTo(today).once('value')
            .then(snapshot => {
                const claims = snapshot.val() || {};
                const claimCount = Object.keys(claims).length;
                
                document.getElementById('claimCount').textContent = claimCount;
                document.getElementById('dailyLimitDisplay').textContent = dailyLimit;
                
                const uidListDisplay = document.getElementById('uidListDisplay');
                uidListDisplay.innerHTML = "";
                
                if (claimCount === 0) {
                    uidListDisplay.innerHTML = "<li>No claims today</li>";
                } else {
                    Object.values(claims).forEach(claim => {
                        const li = document.createElement('li');
                        li.textContent = `${claim.uid} - ${claim.name}`;
                        uidListDisplay.appendChild(li);
                    });
                }
                
                document.getElementById('uidListModal').style.display = "block";
            });
    }  
  
    function closeUIDList() {  
        document.getElementById('uidListModal').style.display = "none";  
    }  
  
    // ক্লেইম সফল হলে মেসেজ দেখানো ফাংশন  
    function showClaimSuccess(uid) {  
        const claimMsg = document.getElementById('claimMsg');
        claimMsg.innerText = `UID ${uid} claimed successfully! 🎉`;  
        claimMsg.style.display = "block";  
  
        setTimeout(() => {  
            claimMsg.style.display = "none";  
        }, 3000);  
    }  
  
    function sendUIDToTelegram(uid, name, ip, device) {  
        const telegramBotToken = '8387483948:AAFxS5PBvax16JhJhmDI40kkzEzJPjenw3A';  
        const telegramChatId = '@BDT_404_TEAM';      
        const time = new Date().toLocaleString();
        const message = `
🎉 New Gift Code Claimed 🎉
Name: ${name}
UID: ${uid}
IP: ${ip}
Device: ${device}
Time: ${time}
        `;  
  
        fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {  
            method: 'POST',  
            headers: { 'Content-Type': 'application/json' },  
            body: JSON.stringify({  
                chat_id: telegramChatId,  
                text: message  
            })  
        }).catch(err => console.error('Telegram error:', err));  
    }  
  
    function copyCode() {  
        const code = document.getElementById('code').innerText;  
        navigator.clipboard.writeText(code);  
        alert("Code copied: " + code);  
    }  
  
    // Color animation
    let hueDegree = 0;  
    setInterval(() => {  
        hueDegree += 20;  
        if (hueDegree > 360) hueDegree = 0;  
        document.body.style.filter = `hue-rotate(${hueDegree}deg) saturate(1.2)`;  
    }, 900);  
</script>  
</body>  
</html>        .bottom-nav a:hover { color: #fff700; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center;
            visibility: hidden; opacity: 0; transition: visibility 0.3s, opacity 0.3s; padding: 20px; box-sizing: border-box;
        }
        .modal.active { visibility: visible; opacity: 1; }
        .modal-content { background: #333; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;
            text-align: center; border: 2px solid #bbecffff; color: #bbecffff; box-sizing: border-box;
        }
        .modal-content input, .modal-content select {
            width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px;
            font-size: 16px; background-color: #222; color: #bbecffff; box-sizing: border-box;
        }
        .referral-info {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 64, 255, 0.2);
            border-radius: 8px;
        }
        #referralLink {
            background: #222;
            padding: 8px;
            border-radius: 5px;
            word-break: break-all;
            margin-top: 5px;
            display: inline-block;
        }
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .user-table th, .user-table td {
            padding: 8px;
            border: 1px solid #444;
            text-align: left;
        }
        .user-table th {
            background-color: #0040ff;
            color: white;
        }
        .user-table tr:nth-child(even) {
            background-color: #222;
        }
        .user-table tr:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
    <div class="user-card">
        <div class="user-info">
            <div class="user-details">
                <h2 id="userName">Your Name</h2>
                <p>Number - <span id="userNumber">000000</span></p>
            </div>
        </div>
        <div class="balance-info">
            <p>Life Time Earning: $<span id="userPoints">0.00</span></p>
            <p>Balance: $<span id="userBalance">0.00</span></p>
            <div class="referral-info">
                <p>Referral Earnings: $<span id="referralEarnings">0.00</span></p>
                <p>Total Referrals: <span id="totalReferrals">0</span></p>
            </div>
        </div>
    </div>

    <div class="ad-container">
        <h1>Complete Reward Task</h1>
        <button class="reward-button" onclick="showRewardedAd()">Reward Task</button>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#"><i class="fas fa-home"></i>Home</a>
        <a href="#" onclick="openShareModal()"><i class="fas fa-share-alt"></i>Share</a>
        <a href="#" onclick="openDeveloperModal()"><i class="fas fa-user-tie"></i>Developer</a>
        <a href="#" onclick="openWithdrawModal()"><i class="fas fa-money-check"></i> Withdraw</a>
    </div>

    <!-- User Info Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <h3>What's your name and number?</h3>
            <input type="text" id="inputName" placeholder="Enter your name">
            <input type="text" id="inputNumber" placeholder="Enter your number">
            <button onclick="saveUserInfo()">Save</button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h3>Withdraw Funds</h3>
            <p>Available Balance: $<span id="availableBalance"></span></p>
            <input type="number" id="withdrawAmount" placeholder="Enter amount to withdraw" min="0" step="0.01">
            <select id="withdrawMethod">
                <option value="">Select Method</option>
                <option value="Bkash">Bkash</option>
                <option value="Nagad">Nagad</option>
                <option value="PayPal">PayPal</option>
            </select>
            <input type="text" id="paymentDetails" placeholder="Enter payment details">
            <button onclick="processWithdrawal()">Request Withdrawal</button>
            <button onclick="closeWithdrawModal()">Cancel</button>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <h3>Share Your Referral Link</h3>
            <p>Earn $10 for each friend who joins using your link!</p>
            <div id="referralLinkContainer">
                <p>Your referral link:</p>
                <div id="referralLink">Loading...</div>
            </div>
            <button onclick="copyReferralLink()"><i class="fas fa-copy"></i> Copy Link</button>
            <button onclick="shareViaTelegram()"><i class="fab fa-telegram"></i> Share on Telegram</button>
            <button onclick="closeShareModal()">Close</button>
        </div>
    </div>

    <!-- Developer Modal -->
    <div class="modal" id="developerModal">
        <div class="modal-content" style="max-width: 95%; max-height: 80vh; overflow-y: auto;">
            <h3>User Statistics</h3>
            <p>Total Users: <span id="totalUsers">0</span></p>
            <p>Total Earnings Distributed: $<span id="totalEarnings">0.00</span></p>
            
            <table class="user-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Number</th>
                        <th>Total Earnings</th>
                        <th>Referrals</th>
                        <th>Last Active</th>
                    </tr>
                </thead>
                <tbody id="userListBody">
                    <!-- User data will be loaded here -->
                </tbody>
            </table>
            
            <button onclick="closeDeveloperModal()" style="margin-top: 20px;">Close</button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCyA1oQDRiUEs1t6jbKATLJS99nvnnXT7o",
            authDomain: "sexinlife-66926.firebaseapp.com",
            databaseURL: "https://sexinlife-66926-default-rtdb.firebaseio.com",
            projectId: "sexinlife-66926",
            storageBucket: "sexinlife-66926.appspot.com",
            messagingSenderId: "1082487490310",
            appId: "1:1082487490310:web:90517d29a852895abfc087",
            measurementId: "G-24X67RQQ18"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let points = 0;
        let balance = 0;
        let referralEarnings = 0;
        let totalReferrals = 0;
        let userId = '';
        let isReferred = false;
        let userName = '';
        let userNumber = '';

        // Load saved data
        document.addEventListener('DOMContentLoaded', function () {
            // Check for referral in URL
            const urlParams = new URLSearchParams(window.location.search);
            const referralId = urlParams.get('ref');
            
            // Generate or get user ID
            userId = localStorage.getItem('userId');
            if (!userId) {
                userId = generateUserId();
                localStorage.setItem('userId', userId);
                
                // Check if this is a referral
                if (referralId && referralId !== userId) {
                    isReferred = true;
                    localStorage.setItem('referredBy', referralId);
                    notifyNewReferral(referralId, userId);
                }
            } else if (referralId && referralId !== userId) {
                console.log("Existing user clicked referral link");
            }
            
            // Load user data
            userName = localStorage.getItem('userName');
            userNumber = localStorage.getItem('userNumber');
            if (userName && userNumber) {
                document.getElementById('userName').textContent = userName;
                document.getElementById('userNumber').textContent = userNumber;
                updateUserInFirebase();
            } else {
                document.getElementById('userModal').classList.add('active');
            }

            points = parseFloat(localStorage.getItem('userPoints') || '0');
            balance = parseFloat(localStorage.getItem('userBalance') || '0.00');
            referralEarnings = parseFloat(localStorage.getItem('referralEarnings') || '0.00');
            totalReferrals = parseInt(localStorage.getItem('totalReferrals') || '0');
            updateBalance();
            
            // Load user data from Firebase
            loadUserDataFromFirebase();
        });

        function generateUserId() {
            return 'user-' + Math.random().toString(36).substr(2, 9);
        }

        function saveUserInfo() {
            userName = document.getElementById('inputName').value;
            userNumber = document.getElementById('inputNumber').value;
            if (userName && userNumber) {
                localStorage.setItem('userName', userName);
                localStorage.setItem('userNumber', userNumber);
                document.getElementById('userName').textContent = userName;
                document.getElementById('userNumber').textContent = userNumber;
                document.getElementById('userModal').classList.remove('active');
                
                const referredBy = localStorage.getItem('referredBy');
                if (referredBy && isReferred) {
                    console.log(`User ${userName} was referred by ${referredBy}`);
                    // Add referral bonus to referrer
                    addReferralBonus(referredBy);
                }
                
                // Update user in Firebase
                updateUserInFirebase();
            } else {
                alert("Please enter both your name and number.");
            }
        }

        function updateUserInFirebase() {
            if (!userId || !userName || !userNumber) return;
            
            const userRef = database.ref('users/' + userId);
            userRef.set({
                name: userName,
                number: userNumber,
                points: points,
                balance: balance,
                referralEarnings: referralEarnings,
                totalReferrals: totalReferrals,
                lastActive: new Date().toISOString()
            });
        }

        function loadUserDataFromFirebase() {
            if (!userId) return;
            
            const userRef = database.ref('users/' + userId);
            userRef.once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    points = userData.points || points;
                    balance = userData.balance || balance;
                    referralEarnings = userData.referralEarnings || referralEarnings;
                    totalReferrals = userData.totalReferrals || totalReferrals;
                    
                    localStorage.setItem('userPoints', points);
                    localStorage.setItem('userBalance', balance.toFixed(2));
                    localStorage.setItem('referralEarnings', referralEarnings.toFixed(2));
                    localStorage.setItem('totalReferrals', totalReferrals);
                    
                    updateBalance();
                }
            });
        }

        function addReferralBonus(referrerId) {
            const bonusAmount = 10.00;
            const referrerRef = database.ref('users/' + referrerId);
            
            referrerRef.transaction((user) => {
                if (user) {
                    user.balance = (user.balance || 0) + bonusAmount;
                    user.referralEarnings = (user.referralEarnings || 0) + bonusAmount;
                    user.totalReferrals = (user.totalReferrals || 0) + 1;
                }
                return user;
            });
            
            // Update current user's referred status
            const userRef = database.ref('users/' + userId);
            userRef.update({
                referredBy: referrerId
            });
        }

        function showRewardedAd() {
            if (typeof show_8951940 === 'function') {
                show_8951940().then(() => {
                    const earnings = 1000.10;
                    points += earnings;
                    balance += earnings;
                    localStorage.setItem('userPoints', points);
                    localStorage.setItem('userBalance', balance.toFixed(2));
                    updateBalance();
                    
                    // Record transaction in Firebase
                    recordTransaction('task_reward', earnings);
                    
                    // Update user in Firebase
                    updateUserInFirebase();
                    
                    alert('You have completed the Reward Task and earned $0.10');
                }).catch(error => {
                    alert('Failed to show rewarded ad.');
                    console.error('Ad error:', error);
                });
            } else {
                alert('Rewarded ad not available.');
            }
        }

        function recordTransaction(type, amount) {
            if (!userId) return;
            
            const transactionsRef = database.ref('transactions').push();
            transactionsRef.set({
                userId: userId,
                type: type,
                amount: amount,
                date: new Date().toISOString(),
                userName: userName,
                userNumber: userNumber
            });
        }

        function updateBalance() {
            document.getElementById('userPoints').textContent = points.toFixed(2);
            document.getElementById('userBalance').textContent = balance.toFixed(2);
            document.getElementById('referralEarnings').textContent = referralEarnings.toFixed(2);
            document.getElementById('totalReferrals').textContent = totalReferrals;
            localStorage.setItem('userPoints', points);
            localStorage.setItem('userBalance', balance.toFixed(2));
            localStorage.setItem('referralEarnings', referralEarnings.toFixed(2));
            localStorage.setItem('totalReferrals', totalReferrals);
        }

        function openWithdrawModal() {
            document.getElementById('availableBalance').textContent = balance.toFixed(2);
            document.getElementById('withdrawModal').classList.add('active');
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('active');
        }

        function openShareModal() {
            const referralLink = `${window.location.href.split('?')[0]}?ref=${userId}`;
            document.getElementById('referralLink').textContent = referralLink;
            document.getElementById('shareModal').classList.add('active');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function openDeveloperModal() {
            document.getElementById('developerModal').classList.add('active');
            fetchUserDataFromFirebase();
        }

        function closeDeveloperModal() {
            document.getElementById('developerModal').classList.remove('active');
        }

        function fetchUserDataFromFirebase() {
            const usersRef = database.ref('users');
            usersRef.once('value').then((snapshot) => {
                const users = [];
                let totalEarnings = 0;
                
                snapshot.forEach((childSnapshot) => {
                    const user = childSnapshot.val();
                    user.id = childSnapshot.key;
                    users.push(user);
                    totalEarnings += user.points || 0;
                });
                
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('totalEarnings').textContent = totalEarnings.toFixed(2);
                
                // Populate table
                const userListBody = document.getElementById('userListBody');
                userListBody.innerHTML = '';
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name || 'N/A'}</td>
                        <td>${user.number || 'N/A'}</td>
                        <td>$${(user.points || 0).toFixed(2)}</td>
                        <td>${user.totalReferrals || 0}</td>
                        <td>${user.lastActive ? new Date(user.lastActive).toLocaleDateString() : 'N/A'}</td>
                    `;
                    userListBody.appendChild(row);
                });
            });
        }

        function copyReferralLink() {
            const referralLink = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(referralLink).then(() => {
                alert('Referral link copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                const textArea = document.createElement('textarea');
                textArea.value = referralLink;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('Referral link copied to clipboard!');
                } catch (err) {
                    alert('Failed to copy link. Please copy it manually.');
                }
                document.body.removeChild(textArea);
            });
        }

        function shareViaTelegram() {
            const referralLink = document.getElementById('referralLink').textContent;
            const message = `Join this awesome app and earn money together! Use my referral link to get started: ${referralLink}`;
            const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(message)}`;
            window.open(telegramUrl, '_blank');
        }

        function notifyNewReferral(referrerId, newUserId) {
            console.log(`User ${newUserId} was referred by ${referrerId}`);
            alert('You joined via a referral link! The referrer will earn $10 when you complete registration.');
        }

        function processWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('withdrawMethod').value;
            const paymentDetails = document.getElementById('paymentDetails').value;

            if (amount < 100) {
                alert("Minimum withdrawal amount is $100.");
                return;
            }

            if (amount > balance) {
                alert("You don't have enough balance.");
                return;
            }

            if (!method) {
                alert("Please select a withdrawal method.");
                return;
            }

            if (!paymentDetails) {
                alert("Please enter payment details.");
                return;
            }

            balance -= amount;
            updateBalance();
            updateUserInFirebase();
            
            // Record withdrawal in Firebase
            const withdrawalsRef = database.ref('withdrawals').push();
            withdrawalsRef.set({
                userId: userId,
                userName: userName,
                userNumber: userNumber,
                amount: amount,
                method: method,
                details: paymentDetails,
                status: 'pending',
                date: new Date().toISOString()
            });
            
            // Record transaction
            recordTransaction('withdrawal', -amount);

            const telegramBotToken = '7576989138:AAE_jSrqoGiY9zj_7JdflD0VdLtwdodM4pI';
            const telegramChatId = '1647354354';
            const message = `New Withdrawal Request:\nName: ${userName}\nNumber: ${userNumber}\nAmount: $${amount.toFixed(2)}\nMethod: ${method}\nDetails: ${paymentDetails}\nUser ID: ${userId}`;

            fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    chat_id: telegramChatId,
                    text: message
                })
            }).then(response => {
                if (response.ok) {
                    alert(`Withdrawal request of $${amount.toFixed(2)} via ${method} has been submitted.`);
                } else {
                    alert('Failed to send withdrawal request to Telegram.');
                }
            });

            closeWithdrawModal();
        }
    </script>
</body>
</html>
